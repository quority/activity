{"version":3,"sources":["../src/framework/ActivityItem.ts","../src/framework/discussions/DiscussionsItem.ts","../src/framework/discussions/CommentItem.ts","../src/framework/discussions/MessageWallItem.ts","../src/framework/discussions/PostItem.ts","../src/framework/logevents/LogEventsItem.ts","../src/framework/logevents/BlockEventItem.ts","../src/framework/logevents/DeleteEventItem.ts","../src/framework/logevents/MoveEventItem.ts","../src/framework/logevents/ProtectEventItem.ts","../src/framework/logevents/RightsEventItem.ts","../src/framework/logevents/ThanksEventItem.ts","../src/framework/logevents/UploadEventItem.ts","../src/framework/recentchanges/RecentChangesItem.ts","../src/scripts/fandom/get-social-activity.ts","../src/scripts/get-activity.ts","../src/scripts/get-log-events.ts","../src/scripts/get-recent-changes.ts"],"names":["ActivityType","ActivityItem","wiki","DiscussionsAPI","DiscussionsItem","data","thread","CommentItem","url","MessageWallItem","forumName","PostItem","LogEventsItem","BlockEventItem","params","DeleteEventItem","MoveEventItem","ProtectEventItem","RightsEventItem","ThanksEventItem","UploadEventItem","RecentChangesItem","Fandom","hasDiscussions","statusCode","getSocialActivity","from","to","fandom","result","fromMs","toMs","posts","post","created","pageIds","i","articleNames","titles","list","pageId","item","id","getLogEvents","supportedTypes","getRecentChanges","logEventsConstructors","getActivityDate","getActivity","activity","constructor","type","a","b"],"mappings":"AAKO,IAAKA,OACXA,IAAA,6BACAA,IAAA,yBACAA,IAAA,iCAHWA,OAAA,IAMUC,EAAf,KAA4B,CAElB,KAET,YAAaC,EAAa,CAChC,KAAK,KAAOA,CACb,CACO,eAAyC,CAC/C,OAAO,KAAK,OAAS,CACtB,CAEO,aAAqC,CAC3C,OAAO,KAAK,OAAS,CACtB,CAEO,iBAA6C,CACnD,OAAO,KAAK,OAAS,CACtB,CACD,EC3BA,OAAS,kBAAAC,MAAsB,kBAKxB,IAAeC,EAAf,cAAuCH,CAAa,CAChD,OACM,KAET,YAAaC,EAAYG,EAAsC,CACrE,MAAOH,CAAK,EACZ,KAAK,KAAOG,CACb,CAEA,IAAW,eAAyI,CACnJ,IAAMC,EAAS,KAAK,KAAK,UAAU,SAAU,GAC7C,GAAMA,GAEC,GAAKA,EAAO,gBAAkBH,EAAe,eAAe,MAAQG,EAAO,gBAAkBH,EAAe,eAAe,MACjI,MAAM,IAAI,MAAO,8BAA+BG,EAAO,eAAiB,MAFxE,OAAM,IAAI,MAAO,qBAAsB,EAIxC,OAAOA,EAAO,aACf,CAEO,WAAiC,CACvC,OAAO,KAAK,gBAAkBH,EAAe,eAAe,cAC7D,CAEO,eAAyC,CAC/C,OAAO,KAAK,gBAAkBA,EAAe,eAAe,IAC7D,CAEO,QAA2B,CACjC,OAAO,KAAK,gBAAkBA,EAAe,eAAe,KAC7D,CAGD,ECrCO,IAAMI,EAAN,cAA0BH,CAAgB,CAChD,IAAW,SAAkB,CAC5B,OAAO,KAAK,KAAK,UAAU,SAAU,GAAI,aAAe,EACzD,CAEO,QAAc,CACpB,IAAMI,EAAM,KAAK,KAAK,OAAQ,KAAK,OAAQ,EAC3C,OAAAA,EAAI,aAAa,IAAK,YAAa,KAAK,KAAK,QAAS,EACjD,KAAK,KAAK,UACdA,EAAI,KAAO,KAAK,KAAK,IAEfA,CACR,CACD,ECbO,IAAMC,EAAN,cAA8BL,CAAgB,CACpD,IAAW,MAAe,CACzB,GAAM,CAAE,UAAAM,CAAU,EAAI,KAAK,KAC3B,OAAOA,EAAU,QAAS,eAAgB,EAAG,EAAE,KAAK,CACrD,CAEO,QAAc,CACpB,IAAMF,EAAM,KAAK,KAAK,OAAQ,gBAAiB,KAAK,MAAQ,EAC5D,OAAAA,EAAI,aAAa,IAAK,WAAY,KAAK,KAAK,QAAS,EAChD,KAAK,KAAK,UACdA,EAAI,KAAO,KAAK,KAAK,IAEfA,CACR,CACD,ECdO,IAAMG,EAAN,cAAuBP,CAAgB,CAC7C,IAAW,UAAmB,CAC7B,GAAM,CAAE,UAAAM,CAAU,EAAI,KAAK,KAC3B,OAAOA,CACR,CAEO,QAAc,CACpB,IAAMF,EAAM,KAAK,KAAK,OAAQ,UAAW,KAAK,KAAK,UAAY,EAC/D,OAAK,KAAK,KAAK,UACdA,EAAI,UAAY,MAAO,KAAK,KAAK,MAE3BA,CACR,CACD,ECLO,IAAMI,EAAN,cAA4BX,CAAa,CACrC,OAEH,KAEA,YAAaC,EAAYG,EAAqB,CACpD,MAAOH,CAAK,EACZ,KAAK,KAAOG,CACb,CAEA,IAAW,MAAa,CACvB,OAAO,IAAI,KAAM,KAAK,KAAK,SAAU,CACtC,CACO,SAAkC,CACxC,OAAO,KAAK,KAAK,OAAS,OAC3B,CAEO,UAAoC,CAC1C,OAAO,KAAK,KAAK,OAAS,QAC3B,CAEO,QAAgC,CACtC,OAAO,KAAK,KAAK,OAAS,MAC3B,CAEO,WAAsC,CAC5C,OAAO,KAAK,KAAK,OAAS,SAC3B,CAEO,UAAoC,CAC1C,OAAO,KAAK,KAAK,OAAS,QAC3B,CAEO,UAAoC,CAC1C,OAAO,KAAK,KAAK,OAAS,QAC3B,CAEO,UAAoC,CAC1C,OAAO,KAAK,KAAK,OAAS,QAC3B,CACD,EChDO,IAAMQ,EAAN,cAA6BD,CAAc,CACjD,IAAW,YAA0B,CACpC,GAAK,KAAK,WAAW,GAAK,KAAK,aAAa,EAAI,CAC/C,GAAM,CAAE,OAAAE,CAAO,EAAI,KAAK,KACxB,GAAKA,EACJ,OAAO,IAAI,KAAMA,EAAO,MAAO,CAEjC,CACA,OAAO,IACR,CAEO,YAAa,CACnB,OAAO,KAAK,KAAK,SAAW,OAC7B,CAEO,cAAe,CACrB,OAAO,KAAK,KAAK,SAAW,SAC7B,CAEO,cAAe,CACrB,OAAO,KAAK,KAAK,SAAW,SAC7B,CACD,ECtBO,IAAMC,EAAN,cAA8BH,CAAc,CAC3C,YAAa,CACnB,OAAO,KAAK,KAAK,SAAW,QAC7B,CAEO,aAAc,CACpB,OAAO,KAAK,KAAK,SAAW,SAC7B,CACD,ECRO,IAAMI,EAAN,cAA4BJ,CAAc,CAChD,IAAW,MAAe,CACzB,OAAO,KAAK,KAAK,KAClB,CAEA,IAAW,IAAa,CACvB,GAAM,CAAE,OAAAE,CAAO,EAAI,KAAK,KAGxB,OAAOA,EAAO,YACf,CACD,ECXO,IAAMG,EAAN,cAA+BL,CAAc,CAC5C,cAAe,CACrB,OAAO,KAAK,KAAK,SAAW,SAC7B,CAEO,aAAc,CACpB,OAAO,KAAK,KAAK,SAAW,QAC7B,CAEO,gBAAiB,CACvB,OAAO,KAAK,KAAK,SAAW,WAC7B,CACD,ECZO,IAAMM,EAAN,cAA8BN,CAAc,CAEnD,ECFO,IAAMO,EAAN,cAA8BP,CAAc,CAEnD,ECFO,IAAMQ,EAAN,cAA8BR,CAAc,CAC3C,aAAc,CACpB,OAAO,KAAK,KAAK,SAAW,QAC7B,CAEO,eAAgB,CACtB,OAAO,KAAK,KAAK,SAAW,WAC7B,CAEO,aAAc,CACpB,OAAO,KAAK,KAAK,SAAW,QAC7B,CACD,ECTO,IAAMS,EAAN,cAAgCpB,CAAa,CACzC,OAEM,KAET,YAAaC,EAAYG,EAAyB,CACxD,MAAOH,CAAK,EACZ,KAAK,KAAOG,CACb,CAEA,IAAW,MAAa,CACvB,OAAO,IAAI,KAAM,KAAK,KAAK,SAAU,CACtC,CAEA,IAAW,UAAmB,CAC7B,OAAO,KAAK,KAAK,OAAS,KAAK,KAAK,MACrC,CACD,ECtBA,OAAS,kBAAAF,EAAgB,UAAAmB,MAAc,kBAGvC,IAAMC,EAAiB,MAAQrB,GAA0C,CACxE,IAAMM,EAAM,IAAI,IAAK,cAAeN,EAAK,GAAI,EAC7CM,EAAI,aAAa,IAAK,aAAc,gBAAiB,EACrDA,EAAI,aAAa,IAAK,SAAU,UAAW,EAC3C,GAAM,CAAE,WAAAgB,CAAW,EAAI,MAAMtB,EAAK,QAAQ,IAAKM,EAAK,CAAE,OAAQ,MAAO,CAAE,EACvE,OAAOgB,IAAe,GACvB,EAEaC,EAAoB,MAAQvB,EAAYwB,EAAYC,IAAc,CAC9E,GAAK,EAAGzB,EAAK,oBAAoBoB,GAAW,MAAO,CAAC,EAEpD,GAAK,CADe,MAAMC,EAAgBrB,CAAqB,EAC3C,MAAO,CAAC,EAE5B,IAAM0B,EAAS1B,EAET2B,EAAS,MADID,EAAO,OAAO,MAAM,yBACP,SAAS,EAEnCE,EAASJ,EAAK,QAAQ,EACtBK,EAAOJ,EAAG,QAAQ,EAElBK,EAAQH,EAAO,UAAW,aAAc,OAAQI,GAAQ,CAC7D,IAAMC,EAAUD,EAAK,aAAa,YAAc,IAChD,OAAOC,GAAWJ,GAAUI,GAAWH,CACxC,CAAE,EAEII,EAAUH,EAAM,OAAQI,GAAKA,EAAE,UAAU,SAAU,GAAI,gBAAkBjC,EAAe,eAAe,cAAe,EAC1H,IAAKiC,GAAKA,EAAE,UAAU,SAAU,GAAI,WAAY,EAChD,OAAQ,OAAQ,EACZC,EAAe,MAAMT,EAAO,OAAO,MAAM,wBAAwB,4BAA6BO,CAAQ,EAOtGG,EAAS,OAAO,QAASD,EAAa,YAAa,EAAE,OAAQ,CAAEE,EAAM,CAC1EC,EAAQC,CACT,KACCF,EAAMC,GAAWC,EAAK,MACfF,GACL,CAAC,CAA4B,EAEhC,OAAOP,EAAM,IAAKC,GAAQ,CACzB,GAAKA,EAAK,UAAU,SAAU,GAAI,gBAAkB9B,EAAe,eAAe,eAAiB,CAClG,IAAMuC,EAAKT,EAAK,UAAU,OAAQ,GAAI,YACtCA,EAAK,UAAU,OAAQ,GAAI,YAAcK,EAAQI,IAAqCA,CACvF,CACA,OAAOT,CACR,CAAE,CACH,EClDA,OAAS,kBAAA9B,MAAsB,kBCAxB,IAAMwC,EAAe,MAAQzC,EAAYwB,EAAYC,IAAwC,CACnG,IAAMiB,EAAiB,IAAI,IAAK,CAE/B,cAAe,gBAAiB,gBAGhC,gBAAiB,iBAGjB,YAGA,kBAAmB,iBAAkB,oBAGrC,gBAGA,gBAAiB,mBAAoB,gBAGrC,cACD,CAAE,EAcF,OAZiB,MAAM1C,EAAK,UAAW,CACtC,MAAO,QACP,MAAOyB,EAAG,YAAY,EACtB,QAAS,MACT,OAAQ,CACP,UAAW,UAAW,MAAO,OAAQ,YAAa,QAAS,OAAQ,OAAQ,QAC5E,EACA,QAASD,EAAK,YAAY,EAE1B,KAAM,WACP,CAAE,GAEc,OAAQe,GAAQG,EAAe,IAAK,GAAIH,EAAK,QAAUA,EAAK,QAAU,CAAE,CACzF,ECrCO,IAAMI,EAAmB,CAAE3C,EAAYwB,EAAYC,IAAczB,EAAK,UAAW,CACvF,KAAM,gBACN,MAAO,QACP,MAAOyB,EAAG,YAAY,EACtB,QAAS,MACT,OAAQ,CACP,UAAW,MAAO,WAAY,QAAS,YAAa,QAAS,OAAQ,OACtE,EACA,OAAQ,OACR,QAASD,EAAK,YAAY,EAC1B,OAAQ,CACP,OAAQ,KACT,CACD,CAAE,EFPF,IAAMoB,EAA8D,CACnE,MAAOjC,EACP,OAAQE,EACR,KAAMC,EACN,QAASC,EACT,OAAQC,EACR,OAAQE,CACT,EAEa2B,EAAoBN,GAC3BA,EAAK,cAAc,EAChBA,EAAK,KAAK,aAAa,YAAc,IACjCA,EAAK,YAAY,GAAKA,EAAK,gBAAgB,EAC/CA,EAAK,KAAK,QAAQ,EAElB,KAAK,IAAI,EAILO,GAAc,MAAQ9C,EAAYwB,EAAYC,IAAuC,CACjG,IAAMsB,EAA2B,CAAC,EAElC,QAAYR,KAAQ,MAAMI,EAAkB3C,EAAMwB,EAAMC,CAAG,EAC1DsB,EAAS,KAAM,IAAI5B,EAAmBnB,EAAMuC,CAAK,CAAE,EAEpD,QAAYA,KAAQ,MAAME,EAAczC,EAAMwB,EAAMC,CAAG,EAAI,CAC1D,IAAMuB,EAAcJ,EAAuBL,EAAK,OAAU7B,EAC1DqC,EAAS,KAAM,IAAIC,EAAahD,EAAMuC,CAAK,CAAE,CAC9C,CACA,QAAYA,KAAQ,MAAMhB,EAAmBvB,EAAMwB,EAAMC,CAAG,EAAI,CAC/D,IAAMwB,EAAOV,EAAK,UAAU,SAAU,GAAI,cACrCU,IAAShD,EAAe,eAAe,eAC3C8C,EAAS,KAAM,IAAI1C,EAAaL,EAAMuC,CAAK,CAAE,EAClCU,IAAShD,EAAe,eAAe,MAClD8C,EAAS,KAAM,IAAItC,EAAUT,EAAMuC,CAAK,CAAE,EAE1CQ,EAAS,KAAM,IAAIxC,EAAiBP,EAAMuC,CAAK,CAAE,CAEnD,CAEA,OAAOQ,EAAS,KAAM,CAAEG,EAAGC,IAAON,EAAiBK,CAAE,EAAIL,EAAiBM,CAAE,CAAE,CAC/E","sourcesContent":["import type { DiscussionsItem } from './discussions'\r\nimport type { LogEventsItem } from './logevents'\r\nimport type { RecentChangesItem } from './recentchanges'\r\nimport type { Wiki } from '@quority/core'\r\n\r\nexport enum ActivityType {\r\n\tDiscussions,\r\n\tLogEvents,\r\n\tRecentChanges\r\n}\r\n\r\nexport abstract class ActivityItem {\r\n\tprotected abstract type: ActivityType\r\n\tpublic readonly wiki: Wiki\r\n\r\n\tpublic constructor( wiki: Wiki ) {\r\n\t\tthis.wiki = wiki\r\n\t}\r\n\tpublic isDiscussions(): this is DiscussionsItem {\r\n\t\treturn this.type === ActivityType.Discussions\r\n\t}\r\n\r\n\tpublic isLogEvents(): this is LogEventsItem {\r\n\t\treturn this.type === ActivityType.LogEvents\r\n\t}\r\n\r\n\tpublic isRecentChanges(): this is RecentChangesItem {\r\n\t\treturn this.type === ActivityType.RecentChanges\r\n\t}\r\n}\r\n","import { ActivityItem, ActivityType } from '../ActivityItem'\r\nimport type { CommentItem } from './CommentItem'\r\nimport { DiscussionsAPI } from '@quority/fandom'\r\nimport type { MessageWallItem } from './MessageWallItem'\r\nimport type { PostItem } from './PostItem'\r\nimport type { Wiki } from '@quority/core'\r\n\r\nexport abstract class DiscussionsItem extends ActivityItem {\r\n\tprotected type = ActivityType.Discussions\r\n\tpublic readonly data: DiscussionsAPI.DiscussionPost\r\n\r\n\tpublic constructor( wiki: Wiki, data: DiscussionsAPI.DiscussionPost ) {\r\n\t\tsuper( wiki )\r\n\t\tthis.data = data\r\n\t}\r\n\r\n\tpublic get containerType(): DiscussionsAPI.ContainerTypes.ArticleComment | DiscussionsAPI.ContainerTypes.Forum | DiscussionsAPI.ContainerTypes.Wall {\r\n\t\tconst thread = this.data._embedded.thread?.[ 0 ]\r\n\t\tif ( !thread ) {\r\n\t\t\tthrow new Error( 'Unavailable thread.' )\r\n\t\t} else if ( thread.containerType === DiscussionsAPI.ContainerTypes.Post || thread.containerType === DiscussionsAPI.ContainerTypes.Reply ) {\r\n\t\t\tthrow new Error( `Unexpected container type: ${ thread.containerType }` )\r\n\t\t}\r\n\t\treturn thread.containerType\r\n\t}\r\n\r\n\tpublic isComment(): this is CommentItem {\r\n\t\treturn this.containerType === DiscussionsAPI.ContainerTypes.ArticleComment\r\n\t}\r\n\r\n\tpublic isMessageWall(): this is MessageWallItem {\r\n\t\treturn this.containerType === DiscussionsAPI.ContainerTypes.Wall\r\n\t}\r\n\r\n\tpublic isPost(): this is PostItem {\r\n\t\treturn this.containerType === DiscussionsAPI.ContainerTypes.Forum\r\n\t}\r\n\r\n\tpublic abstract getUrl(): URL\r\n}\r\n","import { DiscussionsItem } from './DiscussionsItem'\r\n\r\nexport class CommentItem extends DiscussionsItem {\r\n\tpublic get article(): string {\r\n\t\treturn this.data._embedded.thread?.[ 0 ].containerId ?? ''\r\n\t}\r\n\r\n\tpublic getUrl(): URL {\r\n\t\tconst url = this.wiki.getUrl( this.article )\r\n\t\turl.searchParams.set( 'commentId', this.data.threadId )\r\n\t\tif ( this.data.isReply ) {\r\n\t\t\turl.hash = this.data.id\r\n\t\t}\r\n\t\treturn url\r\n\t}\r\n}\r\n","import { DiscussionsItem } from './DiscussionsItem'\r\n\r\nexport class MessageWallItem extends DiscussionsItem {\r\n\tpublic get wall(): string {\r\n\t\tconst { forumName } = this.data as unknown as { forumName: string }\r\n\t\treturn forumName.replace( 'Message Wall', '' ).trim()\r\n\t}\r\n\r\n\tpublic getUrl(): URL {\r\n\t\tconst url = this.wiki.getUrl( `Message Wall:${ this.wall }` )\r\n\t\turl.searchParams.set( 'threadId', this.data.threadId )\r\n\t\tif ( this.data.isReply ) {\r\n\t\t\turl.hash = this.data.id\r\n\t\t}\r\n\t\treturn url\r\n\t}\r\n}\r\n","import { DiscussionsItem } from './DiscussionsItem'\r\n\r\nexport class PostItem extends DiscussionsItem {\r\n\tpublic get category(): string {\r\n\t\tconst { forumName } = this.data as unknown as { forumName: string }\r\n\t\treturn forumName\r\n\t}\r\n\r\n\tpublic getUrl(): URL {\r\n\t\tconst url = this.wiki.getUrl( `../f/p/${ this.data.threadId }` )\r\n\t\tif ( this.data.isReply ) {\r\n\t\t\turl.pathname += `/r/${ this.data.id }`\r\n\t\t}\r\n\t\treturn url\r\n\t}\r\n}\r\n","import { ActivityItem, ActivityType } from '../ActivityItem'\r\nimport type { LogEventsItem as LogEventsAPI, Wiki } from '@quority/core'\r\nimport type { BlockEventItem } from './BlockEventItem'\r\nimport type { DeleteEventItem } from './DeleteEventItem'\r\nimport type { MoveEventItem } from './MoveEventItem'\r\nimport type { ProtectEventItem } from './ProtectEventItem'\r\nimport type { RightsEventItem } from './RightsEventItem'\r\nimport type { ThanksEventItem } from './ThanksEventItem'\r\nimport type { UploadEventItem } from './UploadEventItem'\r\n\r\nexport class LogEventsItem extends ActivityItem {\r\n\tprotected type = ActivityType.LogEvents\r\n\r\n\tpublic data: LogEventsAPI\r\n\r\n\tpublic constructor( wiki: Wiki, data: LogEventsAPI ) {\r\n\t\tsuper( wiki )\r\n\t\tthis.data = data\r\n\t}\r\n\r\n\tpublic get date(): Date {\r\n\t\treturn new Date( this.data.timestamp )\r\n\t}\r\n\tpublic isBlock(): this is BlockEventItem {\r\n\t\treturn this.data.type === 'block'\r\n\t}\r\n\r\n\tpublic isDelete(): this is DeleteEventItem {\r\n\t\treturn this.data.type === 'delete'\r\n\t}\r\n\r\n\tpublic isMove(): this is MoveEventItem {\r\n\t\treturn this.data.type === 'move'\r\n\t}\r\n\r\n\tpublic isProtect(): this is ProtectEventItem {\r\n\t\treturn this.data.type === 'protect'\r\n\t}\r\n\r\n\tpublic isRights(): this is RightsEventItem {\r\n\t\treturn this.data.type === 'rights'\r\n\t}\r\n\r\n\tpublic isThanks(): this is ThanksEventItem {\r\n\t\treturn this.data.type === 'thanks'\r\n\t}\r\n\r\n\tpublic isUpload(): this is UploadEventItem {\r\n\t\treturn this.data.type === 'upload'\r\n\t}\r\n}\r\n","import { LogEventsItem } from './LogEventsItem'\r\n\r\nexport class BlockEventItem extends LogEventsItem {\r\n\tpublic get expiryDate(): Date | null {\r\n\t\tif ( this.isBlocking() || this.isReblocking() ) {\r\n\t\t\tconst { params } = this.data as unknown as { params?: { expiry: string } }\r\n\t\t\tif ( params ) {\r\n\t\t\t\treturn new Date( params.expiry )\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null\r\n\t}\r\n\r\n\tpublic isBlocking() {\r\n\t\treturn this.data.action === 'block'\r\n\t}\r\n\r\n\tpublic isReblocking() {\r\n\t\treturn this.data.action === 'reblock'\r\n\t}\r\n\r\n\tpublic isUnblocking() {\r\n\t\treturn this.data.action === 'unblock'\r\n\t}\r\n}\r\n","import { LogEventsItem } from './LogEventsItem'\r\n\r\nexport class DeleteEventItem extends LogEventsItem {\r\n\tpublic isDeleting() {\r\n\t\treturn this.data.action === 'delete'\r\n\t}\r\n\r\n\tpublic isRestoring() {\r\n\t\treturn this.data.action === 'restore'\r\n\t}\r\n}\r\n","import { LogEventsItem } from './LogEventsItem'\r\n\r\nexport class MoveEventItem extends LogEventsItem {\r\n\tpublic get from(): string {\r\n\t\treturn this.data.title\r\n\t}\r\n\r\n\tpublic get to(): string {\r\n\t\tconst { params } = this.data as unknown as {\r\n\t\t\tparams: { target_title: string }\r\n\t\t}\r\n\t\treturn params.target_title\r\n\t}\r\n}\r\n","import { LogEventsItem } from './LogEventsItem'\r\n\r\nexport class ProtectEventItem extends LogEventsItem {\r\n\tpublic isProtecting() {\r\n\t\treturn this.data.action === 'protect'\r\n\t}\r\n\r\n\tpublic isModifying() {\r\n\t\treturn this.data.action === 'modify'\r\n\t}\r\n\r\n\tpublic isUnprotecting() {\r\n\t\treturn this.data.action === 'unprotect'\r\n\t}\r\n}\r\n","import { LogEventsItem } from './LogEventsItem'\r\n\r\nexport class RightsEventItem extends LogEventsItem {\r\n\r\n}\r\n","import { LogEventsItem } from './LogEventsItem'\r\n\r\nexport class ThanksEventItem extends LogEventsItem {\r\n\r\n}\r\n","import { LogEventsItem } from './LogEventsItem'\r\n\r\nexport class UploadEventItem extends LogEventsItem {\r\n\tpublic isUploading() {\r\n\t\treturn this.data.action === 'upload'\r\n\t}\r\n\r\n\tpublic isOverwriting() {\r\n\t\treturn this.data.action === 'overwrite'\r\n\t}\r\n\r\n\tpublic isReverting() {\r\n\t\treturn this.data.action === 'revert'\r\n\t}\r\n}\r\n","import { ActivityItem, ActivityType } from '../ActivityItem'\r\nimport { type RecentChangesItem as RecentChangesAPI } from '@quority/core'\r\nimport type { Wiki } from '@quority/core'\r\n\r\n\r\nexport class RecentChangesItem extends ActivityItem {\r\n\tprotected type = ActivityType.RecentChanges\r\n\r\n\tpublic readonly data: RecentChangesAPI\r\n\r\n\tpublic constructor( wiki: Wiki, data: RecentChangesAPI ) {\r\n\t\tsuper( wiki )\r\n\t\tthis.data = data\r\n\t}\r\n\r\n\tpublic get date(): Date {\r\n\t\treturn new Date( this.data.timestamp )\r\n\t}\r\n\r\n\tpublic get sizediff(): number {\r\n\t\treturn this.data.newlen - this.data.oldlen\r\n\t}\r\n}\r\n","import { DiscussionsAPI, Fandom } from '@quority/fandom'\r\nimport type { Wiki } from '@quority/core'\r\n\r\nconst hasDiscussions = async ( wiki: Wiki<Fandom> ): Promise<boolean> => {\r\n\tconst url = new URL( './wikia.php', wiki.api )\r\n\turl.searchParams.set( 'controller', 'DiscussionPost' )\r\n\turl.searchParams.set( 'method', 'getPosts' )\r\n\tconst { statusCode } = await wiki.request.raw( url, { method: 'HEAD' } )\r\n\treturn statusCode === 200\r\n}\r\n\r\nexport const getSocialActivity = async ( wiki: Wiki, from: Date, to: Date ) => {\r\n\tif ( !( wiki.platform instanceof Fandom ) ) return []\r\n\tconst discussions = await hasDiscussions( wiki as Wiki<Fandom> )\r\n\tif ( !discussions ) return []\r\n\r\n\tconst fandom = wiki as Wiki<Fandom>\r\n\tconst controller = fandom.custom.wikia.DiscussionPostController\r\n\tconst result = await controller.getPosts()\r\n\r\n\tconst fromMs = from.getTime()\r\n\tconst toMs = to.getTime()\r\n\r\n\tconst posts = result._embedded[ 'doc:posts' ].filter( post => {\r\n\t\tconst created = post.creationDate.epochSecond * 1000\r\n\t\treturn created >= fromMs && created <= toMs\r\n\t} )\r\n\r\n\tconst pageIds = posts.filter( i => i._embedded.thread?.[ 0 ].containerType === DiscussionsAPI.ContainerTypes.ArticleComment )\r\n\t\t.map( i => i._embedded.thread?.[ 0 ].containerId )\r\n\t\t.filter( Boolean ) as Array<`${ number }`>\r\n\tconst articleNames = await fandom.custom.wikia.FeedsAndPostsController.getArticleNamesAndUsernames( pageIds ) as {\r\n\t\tarticleNames: {\r\n\t\t\t[ key in `${ number }` ]: {\r\n\t\t\t\ttitle: string\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tconst titles = Object.entries( articleNames.articleNames ).reduce( ( list, [\r\n\t\tpageId, item\r\n\t] ) => {\r\n\t\tlist[ pageId ] = item.title\r\n\t\treturn list\r\n\t}, {} as Record<string, string> )\r\n\r\n\treturn posts.map( post => {\r\n\t\tif ( post._embedded.thread?.[ 0 ].containerType === DiscussionsAPI.ContainerTypes.ArticleComment ) {\r\n\t\t\tconst id = post._embedded.thread[ 0 ].containerId\r\n\t\t\tpost._embedded.thread[ 0 ].containerId = titles[ id ] as `${ number }` | undefined ?? id\r\n\t\t}\r\n\t\treturn post\r\n\t} )\r\n}\r\n","import { BlockEventItem, CommentItem, DeleteEventItem, LogEventsItem, MessageWallItem, MoveEventItem, PostItem, ProtectEventItem, RecentChangesItem, RightsEventItem, UploadEventItem } from '../framework'\r\nimport type { ActivityItem } from '../framework/ActivityItem'\r\nimport { DiscussionsAPI } from '@quority/fandom'\r\nimport { getLogEvents } from './get-log-events'\r\nimport { getRecentChanges } from './get-recent-changes'\r\nimport { getSocialActivity } from './fandom/get-social-activity'\r\nimport type { Wiki } from '@quority/core'\r\n\r\nconst logEventsConstructors: Record<string, typeof LogEventsItem> = {\r\n\tblock: BlockEventItem,\r\n\tdelete: DeleteEventItem,\r\n\tmove: MoveEventItem,\r\n\tprotect: ProtectEventItem,\r\n\trights: RightsEventItem,\r\n\tupload: UploadEventItem\r\n}\r\n\r\nexport const getActivityDate = ( item: ActivityItem ): number => {\r\n\tif ( item.isDiscussions() ) {\r\n\t\treturn item.data.creationDate.epochSecond * 1000\r\n\t} else if ( item.isLogEvents() || item.isRecentChanges() ) {\r\n\t\treturn item.date.getTime()\r\n\t} else {\r\n\t\treturn Date.now()\r\n\t}\r\n}\r\n\r\nexport const getActivity = async ( wiki: Wiki, from: Date, to: Date ): Promise<ActivityItem[]> => {\r\n\tconst activity: ActivityItem[] = []\r\n\r\n\tfor ( const item of await getRecentChanges( wiki, from, to ) ) {\r\n\t\tactivity.push( new RecentChangesItem( wiki, item ) )\r\n\t}\r\n\tfor ( const item of await getLogEvents( wiki, from, to ) ) {\r\n\t\tconst constructor = logEventsConstructors[ item.type ] ?? LogEventsItem\r\n\t\tactivity.push( new constructor( wiki, item ) )\r\n\t}\r\n\tfor ( const item of await getSocialActivity( wiki, from, to ) ) {\r\n\t\tconst type = item._embedded.thread?.[ 0 ].containerType\r\n\t\tif ( type === DiscussionsAPI.ContainerTypes.ArticleComment ) {\r\n\t\t\tactivity.push( new CommentItem( wiki, item ) )\r\n\t\t} else if ( type === DiscussionsAPI.ContainerTypes.Forum ) {\r\n\t\t\tactivity.push( new PostItem( wiki, item ) )\r\n\t\t} else {\r\n\t\t\tactivity.push( new MessageWallItem( wiki, item ) )\r\n\t\t}\r\n\t}\r\n\r\n\treturn activity.sort( ( a, b ) => getActivityDate( a ) - getActivityDate( b ) )\r\n}\r\n","import type { LogEventsItem, Wiki } from '@quority/core'\r\n\r\nexport const getLogEvents = async ( wiki: Wiki, from: Date, to: Date ): Promise<LogEventsItem[]> => {\r\n\tconst supportedTypes = new Set( [\r\n\t\t// block\r\n\t\t'block/block', 'block/reblock', 'block/unblock',\r\n\r\n\t\t// delete\r\n\t\t'delete/delete', 'delete/restore',\r\n\r\n\t\t// move\r\n\t\t'move/move',\r\n\r\n\t\t// protect\r\n\t\t'protect/protect', 'protect/modify', 'protect/unprotect',\r\n\r\n\t\t// rights\r\n\t\t'rights/rights',\r\n\r\n\t\t// upload\r\n\t\t'upload/upload', 'upload/overwrite', 'upload/revert',\r\n\r\n\t\t// thanks\r\n\t\t'thanks/thank'\r\n\t] )\r\n\r\n\tconst activity = await wiki.queryList( {\r\n\t\tledir: 'newer',\r\n\t\tleend: to.toISOString(),\r\n\t\tlelimit: 'max',\r\n\t\tleprop: [\r\n\t\t\t'comment', 'details', 'ids', 'tags', 'timestamp', 'title', 'type', 'user', 'userid'\r\n\t\t],\r\n\t\tlestart: from.toISOString(),\r\n\t\t// letype: [ 'block', 'delete', 'move', 'protect', 'rights', 'upload' ],\r\n\t\tlist: 'logevents'\r\n\t} )\r\n\r\n\treturn activity.filter( item => supportedTypes.has( `${ item.type }/${ item.action }` ) )\r\n}\r\n","import type { Wiki } from '@quority/core'\r\n\r\nexport const getRecentChanges = ( wiki: Wiki, from: Date, to: Date ) => wiki.queryList( {\r\n\tlist: 'recentchanges',\r\n\trcdir: 'newer',\r\n\trcend: to.toISOString(),\r\n\trclimit: 'max',\r\n\trcprop: [\r\n\t\t'comment', 'ids', 'redirect', 'sizes', 'timestamp', 'title', 'user', 'flags'\r\n\t],\r\n\trcshow: '!bot',\r\n\trcstart: from.toISOString(),\r\n\trctype: [\r\n\t\t'edit', 'new'\r\n\t]\r\n} )\r\n"]}